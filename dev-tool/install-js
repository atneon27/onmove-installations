#!/usr/bin/env bash
set -e

echo "ğŸš€ Installing NVM..."

# Install NVM if not already installed
if [ ! -d "$HOME/.nvm" ]; then
  curl -fsSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
fi

# Add NVM setup to ~/.bashrc if not already there
if ! grep -q 'export NVM_DIR="$HOME/.nvm"' ~/.bashrc; then
  echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
  echo '[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"' >> ~/.bashrc
  echo '[ -s "$NVM_DIR/bash_completion" ] && . "$NVM_DIR/bash_completion"' >> ~/.bashrc
fi

# Ensure NVM is loaded for current session
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && . "$NVM_DIR/bash_completion"

echo "ğŸš€ Installing latest LTS Node.js..."

# Install latest LTS Node.js
nvm install --lts
nvm alias default 'lts/*'

echo "ğŸš€ Enabling Corepack..."

# Enable Corepack for pnpm
corepack enable

echo "ğŸš€ Activating pnpm..."

# Activate pnpm
corepack prepare pnpm@latest --activate

echo "âœ… Verifying installation..."

# Verify Node.js, npm, and pnpm versions
node -v
npm -v
pnpm -v

# Add Corepack enable to ~/.bashrc for future sessions
if ! grep -q 'corepack enable' ~/.bashrc; then
  echo 'corepack enable' >> ~/.bashrc
fi

echo "ğŸ‰ Installation complete!"

